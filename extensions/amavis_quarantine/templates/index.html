{% extends "layout.html" %}
{% load i18n %}
{% load amextras %}
{% block html_head %}
<link rel="stylesheet" type="text/css" href="/static/stylesheets/box.css" />
<style type="text/css">
form {
  margin: 0 auto;
  width: 98%;
}

#quarmenu {
  float: left;
  width: 100%;
  margin: 5px 0;
}

#listing {
  float: left;
  width: 100%;
  padding-bottom: 10px;
}

#listheader {
  float: left;
  width: 100%;
  margin-bottom: 10px;
}

#navbar {
  float: right;
}

#counter {
  float: left;
  font-weight: bold;
}

td {
  font-size: smaller;
  height: 40px;
}

#searchbox {
  float: right;
  margin-right: 10px;
}
</style>

<script type="text/javascript">
window.addEvent("domready", function() {
  mysubmit = function(event, name) {
    event.stop();
    new Element('input', {
      'type' : 'submit', 'name' : name, style: "display:none"
    }).inject($("quarlistingform"));
    $("quarlistingform").set("send", {
      onSuccess : function(res) {
        response = JSON.decode(res);
        location.href = response.url;
      }
    });
    $("quarlistingform").send();
  }

  checkSelection = function(text) {
    var getout = $$("input[name=selection]").every(function(item, index) {
      return item.checked == false;
    });
    if (getout) {
      return false;
    }
    return confirm(text);
  }

  toggleSelection = function(value) {
    $$("input[name=selection]").each(function(obj) {
      obj.checked = value;
    });
  }

  $$("a[name=delete]").addEvent("click", function(event) {
    if (!checkSelection("{% trans "Delete this selection?" %}")) {
      event.stop();
      return;
    }
    mysubmit(event, "delete");
  });
  $$("a[name=release]").addEvent("click", function(event) {
    if (!checkSelection("{% trans "Release this selection?" %}")) {
      event.stop();
      return;
    }
    mysubmit(event, "release");
  });

  $("selectall").addEvent("click", function(event) {
    if ($("selectall").checked) {
      toggleSelection(true);
    } else {
      toggleSelection(false);
    }
  });

  {% url extensions.amavis_quarantine.main.search as s_url %}
  $("searchfield").addEvent("change", function(event) {
    new Request.JSON({url: "{{ s_url }}", onSuccess: function(resp) {
      $("listing").set("html", resp.content);
    }}).get({"pattern" : $("searchfield").value});
  });

  $("searchfield").addEvent("click", function(event) {
    $("searchfield").select();
  });

  $("searchfield").addEvent("blur", function(event) {
    if ($("searchfield").value == "") {
      $("searchfield").set("value", "{% trans "Search..." %}");
    }
  });
});
</script>
{% endblock %}

{% block content %}
<div class="header">
  <h1>{% trans "Quarantine" %}</h1>
  {% if messages %}
  <div id="infos">
  {% for m in messages %}
  {{ m }}
  {% endfor %}
  </div>
  {% endif %}
  <div id="searchbox">
    <input type="text" name="searchfield" id="searchfield" value="{% trans "Search..." %}" />
  </div>
</div>

<div id="menubar" class="menu2">
  {% quar_menu "" perms %}
</div>

{% url extensions.amavis_quarantine.main.process as actionurl %}
<form method="POST" action="{{ actionurl }}" id="quarlistingform">
<input type="hidden" name="pagenum" id="pagenum" value="{{ current_page }}" />

<div id="listing">
  {{ content }}
</div>
</form>
{% endblock %}