{% extends "common/email_listing.html" %}
{% load i18n %}
{% load amextras %}
{% block css %}
#searchbox {
  float: left;
  margin-right: 10px;
  width: 250px;
}

#searchbox img {
  float: left;
  margin-top: 4px;
  margin-right: 5px;
}

#searchparams {
  background: white;
  padding: 5px;
  width: 150px;
}
{% endblock %}
{% block js %}
mysubmit = function(event, name) {
  event.stop();
  new Element('input', {
    'type' : 'hidden', 'name' : "action", style: "display:none", 'value' : name
  }).inject($("listingform"), "top");
  {% url extensions.amavis_quarantine.main.process as actionurl %}
  $("listingform").set("action", "{{ actionurl }}");
  $("listingform").set("send", {
      onSuccess : function(res) {
      response = JSON.decode(res);
      location.href = response.url;
    }
  });
  $("listingform").send();
}

$$("a[name=delete]").addEvent("click", function(event) {
  if (!checkSelection("selection", "{% trans "Delete this selection?" %}")) {
    event.stop();
    return;
  }
  mysubmit(event, "delete");
});
$$("a[name=release]").addEvent("click", function(event) {
  if (!checkSelection("selection", "{% trans "Release this selection?" %}")) {
    event.stop();
    return;
  }
  mysubmit(event, "release");
});


var myFx = new Fx.Slide($("searchparams"));
myFx.hide();
$("searchopts").addEvent("click", function(event) {
  myFx.cancel();
  myFx.toggle();
});
$$("input[name=scriteria]").addEvent("click", function(event) {
  myFx.cancel();
  myFx.toggle();
});
$("searchfield").addEvent("change", function(event) {
  var criteria = "";
  $$("input[name=scriteria]:checked").each(function(obj) {
    criteria = obj.value;
  });
  {% url extensions.amavis_quarantine.main.search as s_url %}
  new Request.JSON({url: "{{ s_url }}", onSuccess: function(resp) {
    $("listing").set("html", resp.listing);
    $("navbar").set("html", resp.navbar);
    {% url extensions.amavis_quarantine.main.viewmail as view_url %}
    bindRows("{{ view_url }}", "{{ current_page }}");
  }}).get({"pattern" : $("searchfield").value, "criteria" : criteria});
});
$("searchfield").addEvent("click", function(event) {
  $("searchfield").select();
});

$("searchfield").addEvent("blur", function(event) {
  if ($("searchfield").value == "") {
    $("searchfield").set("value", "{% trans "Search..." %}");
  }
});
{% url extensions.amavis_quarantine.main.viewmail as view_url %}
bindRows("{{ view_url }}", "{{ current_page }}");
{% endblock %}
{% block middletitle %}{% trans "Quarantine" %}{% endblock %}
{% block menu %}
  {% quar_menu "" perms %}
  <div id="searchbox">
    <img src="/static/pics/search.png" id="searchopts" />
    <input type="text" name="searchfield" id="searchfield" value="{% trans "Search..." %}" />
    <div id="searchparams">
      <input type="radio" name="scriteria" value="from_addr" checked>{% trans "From address" %}<br/>
      <input type="radio" name="scriteria" value="subject">{% trans "Subject" %}<br/>
      <input type="radio" name="scriteria" value="from_addr,subject">{% trans "Both" %}<br/>
    </div>
  </div>
{% endblock %}
